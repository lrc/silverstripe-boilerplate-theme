(function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)})(function(e){"use strict";function t(n,r){var i=function(){},o=this,a={autoSelectFirst:!1,appendTo:"body",serviceUrl:null,lookup:null,onSelect:null,width:"auto",minChars:1,maxHeight:300,deferRequestBy:0,params:{},formatResult:t.formatResult,delimiter:null,zIndex:9999,type:"GET",noCache:!1,onSearchStart:i,onSearchComplete:i,containerClass:"autocomplete-suggestions",tabDisabled:!1,dataType:"text",lookupFilter:function(e,t,n){return-1!==e.value.toLowerCase().indexOf(n)},paramName:"query",transformResult:function(e){return e.suggestions}};o.element=n,o.el=e(n),o.suggestions=[],o.badQueries=[],o.selectedIndex=-1,o.currentValue=o.element.value,o.intervalId=0,o.cachedResponse=[],o.onChangeInterval=null,o.onChange=null,o.ignoreValueChange=!1,o.isLocal=!1,o.suggestionsContainer=null,o.options=e.extend({},a,r),o.classes={selected:"autocomplete-selected",suggestion:"autocomplete-suggestion"},o.initialize(),o.setOptions(r)}var n=function(){return{extend:function(t,n){return e.extend(t,n)},addEvent:function(e,t,n){if(e.addEventListener)e.addEventListener(t,n,!1);else{if(!e.attachEvent)throw Error("Browser doesn't support addEventListener or attachEvent");e.attachEvent("on"+t,n)}},removeEvent:function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)},createNode:function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstChild}}}(),r={ESC:27,TAB:9,RETURN:13,UP:38,DOWN:40};t.utils=n,e.Autocomplete=t,t.formatResult=function(e,t){var n=RegExp("(\\"+["/",".","*","+","?","|","(",")","[","]","{","}","\\"].join("|\\")+")","g"),r="("+t.replace(n,"\\$1")+")";return e.value.replace(RegExp(r,"gi"),"<strong>$1</strong>")},t.prototype={killerFn:null,initialize:function(){var n,r=this,i="."+r.classes.suggestion,o=r.classes.selected,a=r.options;r.element.setAttribute("autocomplete","off"),r.killerFn=function(t){0===e(t.target).closest("."+r.options.containerClass).length&&(r.killSuggestions(),r.disableKillerFn())},a.width&&"auto"!==a.width||(a.width=r.el.outerWidth()),r.suggestionsContainer=t.utils.createNode('<div class="'+a.containerClass+'" style="position: absolute; display: none;"></div>'),n=e(r.suggestionsContainer),n.appendTo(a.appendTo).width(a.width),n.on("mouseover",i,function(){r.activate(e(this).data("index"))}),n.on("mouseout",function(){r.selectedIndex=-1,n.children("."+o).removeClass(o)}),n.on("click",i,function(){r.select(e(this).data("index"),!1)}),r.fixPosition(),window.opera?r.el.on("keypress",function(e){r.onKeyPress(e)}):r.el.on("keydown",function(e){r.onKeyPress(e)}),r.el.on("keyup",function(e){r.onKeyUp(e)}),r.el.on("blur",function(){r.onBlur()}),r.el.on("focus",function(){r.fixPosition()})},onBlur:function(){this.enableKillerFn()},setOptions:function(t){var r=this,i=r.options;n.extend(i,t),r.isLocal=e.isArray(i.lookup),r.isLocal&&(i.lookup=r.verifySuggestionsFormat(i.lookup)),e(r.suggestionsContainer).css({"max-height":i.maxHeight+"px",width:i.width+"px","z-index":i.zIndex})},clearCache:function(){this.cachedResponse=[],this.badQueries=[]},disable:function(){this.disabled=!0},enable:function(){this.disabled=!1},fixPosition:function(){var t,n=this;"body"===n.options.appendTo&&(t=n.el.offset(),e(n.suggestionsContainer).css({top:t.top+n.el.outerHeight()+"px",left:t.left+"px"}))},enableKillerFn:function(){var t=this;e(document).on("click",t.killerFn)},disableKillerFn:function(){var t=this;e(document).off("click",t.killerFn)},killSuggestions:function(){var e=this;e.stopKillSuggestions(),e.intervalId=window.setInterval(function(){e.hide(),e.stopKillSuggestions()},300)},stopKillSuggestions:function(){window.clearInterval(this.intervalId)},onKeyPress:function(e){var t=this;if(!t.disabled&&!t.visible&&e.keyCode===r.DOWN&&t.currentValue)return t.suggest(),void 0;if(!t.disabled&&t.visible){switch(e.keyCode){case r.ESC:t.el.val(t.currentValue),t.hide();break;case r.TAB:case r.RETURN:if(-1===t.selectedIndex)return t.hide(),void 0;if(t.select(t.selectedIndex,e.keyCode===r.RETURN),e.keyCode===r.TAB&&this.options.tabDisabled===!1)return;break;case r.UP:t.moveUp();break;case r.DOWN:t.moveDown();break;default:return}e.stopImmediatePropagation(),e.preventDefault()}},onKeyUp:function(e){var t=this;if(!t.disabled){switch(e.keyCode){case r.UP:case r.DOWN:return}clearInterval(t.onChangeInterval),t.currentValue!==t.el.val()&&(t.options.deferRequestBy>0?t.onChangeInterval=setInterval(function(){t.onValueChange()},t.options.deferRequestBy):t.onValueChange())}},onValueChange:function(){var e,t=this;return clearInterval(t.onChangeInterval),t.currentValue=t.element.value,e=t.getQuery(t.currentValue),t.selectedIndex=-1,t.ignoreValueChange?(t.ignoreValueChange=!1,void 0):(e.length<t.options.minChars?t.hide():t.getSuggestions(e),void 0)},getQuery:function(t){var n,r=this.options.delimiter;return r?(n=t.split(r),e.trim(n[n.length-1])):e.trim(t)},getSuggestionsLocal:function(t){var n=this,r=t.toLowerCase(),i=n.options.lookupFilter;return{suggestions:e.grep(n.options.lookup,function(e){return i(e,t,r)})}},getSuggestions:function(t){var n,r=this,i=r.options;n=r.isLocal?r.getSuggestionsLocal(t):r.cachedResponse[t],n&&e.isArray(n.suggestions)?(r.suggestions=n.suggestions,r.suggest()):r.isBadQuery(t)||(i.onSearchStart.call(r.element,t),i.params[i.paramName]=t,e.ajax({url:i.serviceUrl,data:i.params,type:i.type,dataType:i.dataType}).done(function(e){r.processResponse(e),i.onSearchComplete.call(r.element,t)}))},isBadQuery:function(e){for(var t=this.badQueries,n=t.length;n--;)if(0===e.indexOf(t[n]))return!0;return!1},hide:function(){var t=this;t.visible=!1,t.selectedIndex=-1,e(t.suggestionsContainer).hide()},suggest:function(){if(0===this.suggestions.length)return this.hide(),void 0;var t=this,n=t.options.formatResult,r=t.getQuery(t.currentValue),i=t.classes.suggestion,o=t.classes.selected,a=e(t.suggestionsContainer),s="";e.each(t.suggestions,function(e,t){s+='<div class="'+i+'" data-index="'+e+'">'+n(t,r)+"</div>"}),a.html(s).show(),t.visible=!0,t.options.autoSelectFirst&&(t.selectedIndex=0,a.children().first().addClass(o))},verifySuggestionsFormat:function(t){return t.length&&"string"==typeof t[0]?e.map(t,function(e){return{value:e,data:null}}):t},processResponse:function(t){var n=this,r="string"==typeof t?e.parseJSON(t):t;r.suggestions=n.verifySuggestionsFormat(n.options.transformResult(r)),n.options.noCache||(n.cachedResponse[r[n.options.paramName]]=r,0===r.suggestions.length&&n.badQueries.push(r[n.options.paramName])),r[n.options.paramName]===n.getQuery(n.currentValue)&&(n.suggestions=r.suggestions,n.suggest())},activate:function(t){var n,r=this,i=r.classes.selected,o=e(r.suggestionsContainer),a=o.children();return o.children("."+i).removeClass(i),r.selectedIndex=t,-1!==r.selectedIndex&&a.length>r.selectedIndex?(n=a.get(r.selectedIndex),e(n).addClass(i),n):null},select:function(e,t){var n=this,r=n.suggestions[e];r&&(n.el.val(r),n.ignoreValueChange=t,n.hide(),n.onSelect(e))},moveUp:function(){var t=this;if(-1!==t.selectedIndex)return 0===t.selectedIndex?(e(t.suggestionsContainer).children().first().removeClass(t.classes.selected),t.selectedIndex=-1,t.el.val(t.currentValue),void 0):(t.adjustScroll(t.selectedIndex-1),void 0)},moveDown:function(){var e=this;e.selectedIndex!==e.suggestions.length-1&&e.adjustScroll(e.selectedIndex+1)},adjustScroll:function(t){var n,r,i,o=this,a=o.activate(t),s=25;a&&(n=a.offsetTop,r=e(o.suggestionsContainer).scrollTop(),i=r+o.options.maxHeight-s,r>n?e(o.suggestionsContainer).scrollTop(n):n>i&&e(o.suggestionsContainer).scrollTop(n-o.options.maxHeight+s))},onSelect:function(t){var n=this,r=n.options.onSelect,i=n.suggestions[t];n.el.val(n.getValue(i.value)),e.isFunction(r)&&r.call(n.element,i)},getValue:function(e){var t,n,r=this,i=r.options.delimiter;return i?(t=r.currentValue,n=t.split(i),1===n.length?e:t.substr(0,t.length-n[n.length-1].length)+e):e}},e.fn.autocomplete=function(n,r){return this.each(function(){var i,o="autocomplete",a=e(this);"string"==typeof n?(i=a.data(o),"function"==typeof i[n]&&i[n](r)):(i=new t(this,n),a.data(o,i))})}});